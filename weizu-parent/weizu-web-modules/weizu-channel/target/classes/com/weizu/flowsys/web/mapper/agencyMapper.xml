<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.weizu.flowsys.web.agency.dao.AgencyVODaoInterface">

<sql id="agency_backward">agency_backward</sql>
<sql id="charge_account">charge_account</sql>

  <resultMap id="BaseResultMap" type="com.weizu.flowsys.web.agency.pojo.AgencyBackwardPo">
    <id column="agency_id" jdbcType="INTEGER" property="agencyId" />
    <result column="root_agency_id" jdbcType="INTEGER" property="rootAgencyId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="user_pass" jdbcType="VARCHAR" property="userPass" />
    <result column="user_real_name" jdbcType="VARCHAR" property="userRealName" />
    <result column="agency_tel" jdbcType="VARCHAR" property="agencyTel" />
    <result column="user_email" jdbcType="VARCHAR" property="userEmail" />
    <result column="agency_ip" jdbcType="VARCHAR" property="agencyIp" />
    <result column="rate_id" jdbcType="BIGINT" property="rateId" />
    <result column="account_id" jdbcType="INTEGER" property="accountId" />
    <result column="verify_code" property="verifyCode" />
    <result column="user_api_key" property="userApiKey" />
    <result column="create_time" property="createTime" />
  </resultMap>
  <sql id="Base_Column_List">
    agency_id, root_agency_id, user_name, user_pass, user_real_name, agency_tel, user_email, 
    agency_ip, rate_id, account_id
  </sql>
  <resultMap id="OtherMap" type="com.weizu.flowsys.web.agency.pojo.AgencyBackwardVO">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="root_agency_id" jdbcType="INTEGER" property="rootAgencyId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="user_pass" jdbcType="VARCHAR" property="userPass" />
    <result column="user_real_name" jdbcType="VARCHAR" property="userRealName" />
    <result column="agency_tel" jdbcType="VARCHAR" property="agencyTel" />
    <result column="user_email" jdbcType="VARCHAR" property="userEmail" />
    <result column="agency_ip" jdbcType="VARCHAR" property="agencyIp" />
    <result column="rate_id" jdbcType="BIGINT" property="rateId" />
    <result column="bill_rate_id" jdbcType="BIGINT" property="billRateId" />
    <result column="account_credit" jdbcType="DOUBLE" property="accountCredit" />
    <result column="account_balance" jdbcType="DOUBLE" property="accountBalance" />
    <result column="create_time" property="createTime" />
     <result column="user_api_key" property="userApiKey" />
    <result column="verify_code" property="verifyCode" />
  </resultMap>
  <sql id="other_Column_List">
    agb.id,agb.bill_rate_id, root_agency_id, user_name, user_real_name, agency_tel, user_email, 
    agency_ip, rate_id, account_credit, account_balance, create_time
  </sql>
  
  
  <!-- 通过邀请码查询代理商 id-->
  <select id="getAgencyIdByVerifyCode" resultType="java.lang.Integer" parameterType="java.lang.String">
  	select id from <include refid="agency_backward"></include>
  	<where>
  		<if test="_parameter != null">
  			verify_code = #{_parameter}
  		</if>
  	</where>
  </select>
  <!-- 更新代理商信息 -->
  <update id="updateByAgencyPO" parameterType="com.weizu.flowsys.web.agency.pojo.AgencyBackwardPo">
  	update <include refid="agency_backward"></include>
  	<include refid="set_sql"></include>
  	<where>
  		id = #{id}
  	</where>
  </update>
  
  <sql id="set_sql">
  	<set>
  		<if test="verifyCode != null">
  			verify_code = #{verifyCode},
  		</if>
  		<if test="userName != null">
  			user_name = #{userName},
  		</if>
  		<if test="userRealName != null">
  			user_real_name = #{userRealName},
  		</if>
  		<if test="agencyTel != null">
  			agency_tel = #{agencyTel},
  		</if>
  		<if test="userEmail != null">
  			user_email = #{userEmail},
  		</if>
  		<if test="agencyIp != null">
  			agency_ip = #{agencyIp},
  		</if>
  		<if test="rateId != null">
  			rate_id = #{rateId},
  		</if>
  		<if test="createTime != null">
  			create_time = #{createTime},
  		</if>
  	</set>
  </sql>
  <!-- 查询代理商列表 -->
  <select id="selectByAgencyVO" parameterType="com.weizu.flowsys.web.agency.pojo.AgencyBackwardVO" resultMap="OtherMap">
    select 
    <include refid="other_Column_List" />
    from <include refid="agency_backward"></include> agb
    inner join
    <include refid="charge_account"></include> cac
    on agb.id=cac.agency_id
    <where>
   		 <include refid="condition_sql"></include>
   	</where>
	 <if test="start != null">
	 	limit #{start}
	 </if>
	 <if test="end != null">
	 	, #{end}
	 </if>
	 <if test="start == null &amp; end == null">
	 	limit 0,10
	 </if> 
  </select>
  <!-- 查询自己账户信息 -->
  <select id="selectAgencyByPo" parameterType="com.weizu.flowsys.web.agency.pojo.AgencyBackwardPo" resultMap="OtherMap">
    select 
    <include refid="other_Column_List" />
    from <include refid="agency_backward"></include> agb
    inner join
    <include refid="charge_account"></include> cac
    on agb.id=cac.agency_id
    <where>
   		 <include refid="condition_sql"></include>
   	</where>
  </select>
  <!-- 查询下级代理商的全部信息 -->
  <!-- 查询代理商个数 -->
  <select id="countByAgencyVO" parameterType="com.weizu.flowsys.web.agency.pojo.AgencyBackwardVO" resultType="java.lang.Integer">
    select 
    count(*)
    from <include refid="agency_backward"></include> agb
    inner join
    <include refid="charge_account"></include> cac
    on agb.id=cac.agency_id
    <where>
   		 <include refid="condition_sql"></include>
   	</where>
    </select>
 	<!-- 查询where语句块 -->
	<sql id="condition_sql">
		<if test="userName != null">
			AND agb.user_name LIKE CONCAT('%', TRIM(#{userName}), '%')
		</if>
		<if test="rootAgencyId != null">
			AND root_agency_id = #{rootAgencyId}
		</if>
		<!-- <if test="billType != null">
			AND bill_type = #{billType}
		</if> -->
		<if test="id != null">
			AND id = #{id}
		</if>
	</sql>
</mapper>
